<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">
<p><span style="font-family:DejaVu Serif;"><a href="http://sergeyivanov.ru/it/linux/setevoy-servis-sinhronizatsii-vremeni-ntp-centos-ubuntu-sluzhba-vremeni-linux.html">Сетевой сервис синхронизации времени NTP Centos Ubuntu. Служба времени Linux.</a></span></p>
<p>Network Time Protocol (NTP) — сетевой протокол для синхронизации внутренних часов компьютера с использованием сетей с переменной латентностью.</p>
<p>&nbsp;<p> В Linux существует два понятия времени - аппаратное(время в биосе) и системное(с учетом часового пояса). Аппаратное время можно узнать командой hwclock (запускается от имени суперпользователя), где также показывается отставание аппаратных часов от системных(команда date).</p>
<p> [root@centos s]# hwclock</p>
<p> Втр 13 Сен 2011 03:48:49 -1.467155 секунд</p>
<p>&nbsp;<p> Но при решении некоторых задач иногда бывает необходимо записать текущее значение аппаратных часов в системные, для этого используется команда hwclock с опцией --systohc, а если нужно сделать наоборот - записать значение системных часов в аппаратные команда запускается с опцией --hctosys.</p>
<p> [root@centos s]# hwclock --systohc</p>
<p> [root@centos s]# hwclock --hctosys</p>
<p>&nbsp;<p> Если использовать команду date без каких либо опций, то выводится информация в след виде, где вызывают вопрос только 3 буквы - MSD - это летнее время в Москве (наступит осень и будет отображаться MSK).</p>
<p> [root@centos s]# date</p>
<p> Втр Сен 13 00:00:38 MSD 2011</p>
<p>&nbsp;<p> MSK отличается в + от времени по гринвичу на 3 часа, а MSD на 4 .</p>
<p> Установка времени в Linux</p>
<p>&nbsp;<p> Устанавливается время командой date с опцией s, от слова set.</p>
<p> [root@centos s]# date -s 19:10</p>
<p> Втр Сен 13 19:10:00 MSD 2011</p>
<p>&nbsp;<p> Но откуда операционная система знает, в каком регионе в мы живем ? По какому времени ходят системные часы ? Реально они идут по гринвичу, а система смотрит на наличие файла /etc/localtime</p>
<p> [root@centos s]# file /etc/localtime</p>
<p> /etc/localtime: timezone data, version 2, 12 gmt time flags, 12 std time flags,no leap seconds, 129 transition times, 12 abbreviation chars</p>
<p>&nbsp;<p> Запишем в этот файлик данные относящиеся к временной зоне например Нью-Йорка, для чего потребуется выполнить следующую команду:</p>
<p> [root@centos s]# cp /usr/share/zoneinfo/America/New_York /etc/localtime</p>
<p> cp: переписать «/etc/localtime»? y</p>
<p> [root@centos s]# date</p>
<p> Втр Сен 13 11:19:37 EDT 2011</p>
<p>&nbsp;<p>*Кстати вводить длинные команды удобнее используя табуляцию (кнопка TAB), начиная вводить начало каждого слова в команде и нажимая TAB система будет автоматом подставлять значение, что значительно сокращает время набора длинных команд и путей.</p>
<p>&nbsp;<p> Меняя содержимое этого файла, мы меняем все значения, отвечающие за вывод времени, но при этом на системное время мы влияния не оказываем, т.к. оно &quot;ходит&quot; по Гринвичу.</p>
<p>&nbsp;<p> Существует два стандарта времени GMT - Greenwich Mean Time - астрономическое (Среднее солнечное) время меридиана, проходящего через прежнее место расположения Гринвичской королевской обсерватории и UTC - всемирное координированное время, в сущности являющиеся одним и тем же. UTC появилось после того как в США возник вопрос &quot;а по какой из 6ти деревень Гринвич, находящихся в разных штатах проходит Гривический мередиан&quot;. Чтобы не обижать национальные чувства американцев, было применено понятие UTC =))))))</p>
<p>Автоматическая синхронизация времени по протоколу NTP - Network Time Protocol.</p>
<p>&nbsp;<p> Основной параметр серверов времени - Stratum - уровень сервера, сервера с этим параметром, равным 0 не общаются с клиентами, а позволяют синхронизировать время только других серверов синхронизации с уровенем 1 и ниже.</p>
<p>&nbsp;<p> В Линукс есть программка ntpdate, с помощью которой можно синхронизировать системное время с сервером точного времени, предварительно указав при запуске программы(от roota)</p>
<p> [root@centos s]# ntpdate time.nist.gov</p>
<p> 12 Sep 16:37:10 ntpdate[7743]: step time server 192.43.244.18 offset -68520.369071 sec</p>
<p>&nbsp;<p> Если повторять синхронизацию постоянно, то все равно будут отклонения в несколько микросекунд.</p>
<p>&nbsp;<p> Можно использовать для этой цели планировщик CRON, где через заданный промежуток времени будет синхронизироваться время, выглядит это следующим образом:</p>
<p> [root@centos s]# crontab -e</p>
<p> 0 * * * * /usr/sbin/ntpdate сервера NTP</p>
<p>&nbsp;<p> Эта запись значит что каждый час будет запускаться синхронизация с сервером времени.(0.00 1.00 2.00 и тд)</p>
<p>&nbsp;<p> Но можно все сделать гораздо удобнее, установив программу NTP</p>
<p> [root@centos s]# yum install ntp - для Centos</p>
<p> $ sudo apt-get install ntp - для UBUNTU</p>
<p> Теперь настроим программу NTP.</p>
<p>&nbsp;<p>Файл конфигурации:</p>
<p>&nbsp;<p> /etc/ntp.conf</p>
<p>&nbsp;<p> server ntp.ubuntu.com</p>
<p>&nbsp;<p> server time.nist.gov</p>
<p>&nbsp;<p> server europe.pool.ntp.org</p>
<p>&nbsp;<p>Разрешение доступа из локальной сети:</p>
<p>&nbsp;<p> По умолчанию ваш сервер NTP будет доступен всем хостам в Интернет. Параметр restrict в</p>
<p>&nbsp;<p> файле /etc/ntp.conf позволяет вам контролировать, какие машины могут обращаться к вашему</p>
<p>&nbsp;<p> серверу.</p>
<p>&nbsp;<p> Если вы хотите запретить всем машинам обращаться к вашему серверу NTP, добавьте</p>
<p>&nbsp;<p> следующую строку в файл /etc/ntp.conf:</p>
<p>&nbsp;<p> restrict default ignore</p>
<p>&nbsp;<p> Если вы хотите разрешить синхронизировать свои часы с вашим сервером только машинам в</p>
<p>&nbsp;<p> вашей сети, но запретить им настраивать сервер или быть равноправными участниками</p>
<p>&nbsp;<p> синхронизации времени, то вместо указанной добавьте строчку</p>
<p>&nbsp;<p> restrict 10.0.0.0 mask 255.0.0.0 nomodify notrap</p>
<p>&nbsp;<p> /etc/ntp.conf может содержать несколько директив restrict</p>
<p>&nbsp;<p> restrict 10.0.0.0 mask 255.0.0.0 noquery</p>
<p>&nbsp;<p>Логисервера:</p>
<p>&nbsp;<p> /var/log/ntpstats/</p>
<p>&nbsp;<p>Проверка запросов:</p>
<p>&nbsp;<p> ntpq –p</p>
<p>&nbsp;<p>Запуск сервера:</p>
<p>&nbsp;<p> /etc/init.d/ntpd start или service ntpd start - для CentOS</p>
<p>&nbsp;<p> /etc/init.d/ntp start или service ntp start - для Ubuntu.</p>
<p>&nbsp;<p> * Опять же вводя команду узнать имя демона(ntp или ntpd) можно нажав кнопку TAB начав набирать имя сервиса. </p>

</p></body></html>
