<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">ssh</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> is reading the rest of your standard input.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">while read HOST ; do … ; done &lt; servers.txt</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;"></pre>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">read</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> reads from stdin. The </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">&lt;</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> redirects stdin from a file.</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">Unfortunately, the command you're trying to run also reads stdin, so it winds up eating the rest of your file. You can see it clearly with:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">$ while read HOST ; do echo start $HOST end; cat; done &lt; servers.txt </span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">start server1.mydomain.com end</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">server2.mydomain.com</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">server3.mydomain.com</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;"></pre>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">Notice how </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">cat</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> ate (and echoed) the remaining two lines. (Had read done it as expected, each line would have the &quot;start&quot; and &quot;end&quot; around the host.)</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-weight:600; color:#333333;">Why does </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; font-weight:600; color:#222222; background-color:#eeeeee;">for</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-weight:600; color:#333333;"> work?</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">Your </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">for</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> line doesn't redirect to stdin. (In fact, it reads the entire contents of the </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">servers.txt</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> file into memory before the first iteration). So </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">ssh</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> continues to read its stdin from the terminal (or possibly nothing, depending on how your script is called).</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:xx-large; font-weight:600; color:#333333;">Solution</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">At least in bash, you can have </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">read</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> use a different file descriptor.</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">while read -u10 HOST ; do ssh $HOST &quot;uname -a&quot; ; done 10&lt; servers.txt</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">#          ^^^^                                       ^^</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;"></pre>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">ought to work. </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">10</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> is just an arbitrary file number I picked. 0, 1, and 2 have defined meanings, and typically opening files will start from the first available number (so 3 is next to be used). 10 is thus high enough to stay out of the way, but low enough to be under the limit in some shells. Plus its a nice round number...</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:x-large; font-weight:600; color:#333333;">Alternative Solution 1: -n</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">As </span><a href="http://unix.stackexchange.com/users/29821/mcnisse"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#2b6d97;">McNisse</span></a><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> points out in </span><a href="http://unix.stackexchange.com/a/107802/977"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#2b6d97;">his/her answer</span></a><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">, the OpenSSH client has an </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">-n</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;"> option that'll prevent it from reading stdin. This works well in the particular case of </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">ssh</span><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">, but of course other commands may lack this—the other solutions work regardless of which command is eating your stdin.</span></p>
<p style=" margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; font-size:x-large; font-weight:600; color:#333333;">Alternative Solution 2: second redirect</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">You can apparently (as in, I tried it, it works in my version of Bash at least...) do a second redirect, which looks something like this:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eeeeee;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;">while read HOST ; do ssh $HOST &quot;uname -a&quot; &lt; /dev/null; done &lt; servers.txt</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:10px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif'; color:#222222; background-color:#eeeeee;"></pre>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Helvetica Neue,Helvetica,Arial,sans-serif'; color:#333333;">You can use this with any command, but it'll be difficult if you actually want terminal input going to the command.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p></body></html>